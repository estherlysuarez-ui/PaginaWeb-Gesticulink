<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prueba Cámara</title>
</head>
<body>
    <h2>Prueba Cámara</h2>
    <video id="video" autoplay playsinline width="640" height="480"></video>

    <script>
        const video = document.getElementById('video');

        // Abrir la cámara
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error al acceder a la cámara:", err);
            });

        // Conectar al servidor WebSocket en el puerto 5000
        const socket = new WebSocket('ws://localhost:5000');

        socket.addEventListener('open', () => {
            console.log("Conectado al servidor WebSocket en el puerto 5000");

            // Captura frames y envía cada 100ms
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 480;
            const ctx = canvas.getContext('2d');

            setInterval(() => {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                canvas.toBlob(blob => {
                    if (socket.readyState === WebSocket.OPEN) {
                        blob.arrayBuffer().then(buffer => {
                            socket.send(buffer);
                        });
                    }
                }, 'image/jpeg', 0.7);
            }, 100); // cada 100 ms
        });

        socket.addEventListener('close', () => {
            console.log("Conexión cerrada con el servidor WebSocket");
        });

        socket.addEventListener('error', (err) => {
            console.error("Error WebSocket:", err);
        });
    </script>
</body>
</html>
